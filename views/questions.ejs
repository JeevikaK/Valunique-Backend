<!DOCTYPE html>
<html lang="en">
    <%- include ("./partials/head.ejs") %>
    <body>
        <%- include ("./partials/background.ejs") %>

        <div class="content content_questions">
            <nav>
                <div class="dropdown">
                    <a class="btn btn-transparent dropdown-toggle user" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="/images/user-img.png" alt="user-icon">
                        <p><%= candidate_id %></p>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/logout">Sign Out</a></li>
                    </ul>
                </div>
            </nav>
            <img src="/images/Volvo-Logo-2020.png" alt="Volvo Logo" class="volvo_logo">
            <form action="" id="question_submit" method="post" novalidate>
                <div class="questions_content">
                    <p class="question_num">Question <%= id %></p>
                    <p class="questions_page"><%= question %></p>
                    <div class="question_answer">
                        <label for="answer" class="answer_style">
                            Answer
                        </label>
                        <textarea name="answer" rows="4" id="answer" class="answer_area" required maxlength="400" ><%= value %></textarea>
                        <span class="error" aria-live="polite" id="answer_error"><%- message %></span>
                    </div>
                </div>
                <div class="navigate">
                    <% var prev = `/questions/${Number(id)-Number(1)}?candidateId=${candidate_id}&jobId=${jobId}&jobName=${jobName}` %>
                    <% var prevNo = Number(id)-Number(1) %>
                    <% if (prevNo < 1) { %>
                        <% prev = `/details?candidateId=${candidate_id}&jobId=${jobId}&jobName=${jobName}` %>
                    <% } %>
                    <a href="<%= prev %>" id="prev" data-id="<%= prevNo %>"><i class="fa fa-solid fa-chevron-left arrow"></i></a>
                    <p><%= id  %> / <%= questionLength %></p>
                    <% var nextNo = Number(id)+Number(1) %>
                    <a href="#" id="next" data-id="<%= nextNo %>" onclick="myFunction()"><i class=" fa fa-solid fa-chevron-right arrow"></i></a>
                </div>
                <div class="confirm_submit">
                    <input type="submit" value="submit" id="question-submit">
                </div>
            </form>
        </div>

        <%- include ("./partials/footer.ejs") %>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
        <script
            src="https://code.jquery.com/jquery-3.6.0.js"
            integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
            crossorigin="anonymous">
        </script>
        <script>

            if($('#next').data('id') > <%= questionLength %>){
                $('#next').hide();
                $('#question-submit').show();
            }


            //form validation
            const form = document.querySelector('form')
            const answer = document.getElementById('answer')

            function myFunction() {
                console.log('submitted')
                if(!answer.validity.valid){
                    console.log('invalid')
                    showError();
                    event.preventDefault();
                }
                else
                    document.getElementById("question_submit").submit();
            }
                
            function showError(){
                if(answer.validity.valueMissing){
                    document.getElementById('answer_error').innerHTML='<i class="fa fa-exclamation-circle"></i> Please fill this field.';
                }
                else if(answer.validity.tooLong){
                    document.getElementById('answer_error').innerHTML='<i class="fa fa-exclamation-circle"></i> Answer should be less than 400 characters';
                }
            }

            answer.addEventListener("input", event => {
                if(answer.validity.valid){
                    document.getElementById('answer_error').innerHTML='';
                }
                else{
                    showError();
                }
            })

            

        </script>
    </body>
</html>