<!DOCTYPE html>
<html lang="en">
    <%- include ("./partials/head.ejs") %>

<body>
    <%- include ("./partials/background.ejs") %>

    <div class="content content_admin">
        <div class="nav-bar">
            <nav>
                <div class="dropdown">
                    <a class="btn dropdown-toggle user" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" data-adminname="<%= adminName %>" data-adminemail="<%= adminEmail %>" id="admin_profile">
                        <img src="/images/user-img.png" alt="user-icon">
                        <p><%= adminName %></p>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/logout">Sign Out</a></li>
                    </ul>
                </div>
            </nav>
            <div class="logo_admin_page">
                <img src="/images/Volvo-Logo-2020.png" alt="logo">
            </div>
            <div class="admin_choices">
                <div class="search">
                    <label for="search">Search:</label>
                    <input type="text" name="search" id="search" 
                        <% if(type=="applicants"){ %>
                            placeholder=" By Candidate No."
                        <% } else if(type=="access") {%> 
                            placeholder=" By Admin Name"
                        <% } %>
                    >
                </div>
                <div class="nav_admin">
                    <div class="applicant">
                        <a href="<%= `/admin?adminEmail=${adminEmail}&adminName=${adminName}` %>"
                            <% if(type=="applicants"){ %>
                               class= "<%= "selected" %>"
                            <% } %>     
                        > Applications</a>
                    </div>
                    <% if (adminAccess == "HR") {%>
                        <div class="access">
                            <a href="/admin/access"
                                <% if(type=="access"){ %>
                                    class= "<%= "selected" %>"
                                <% } %>
                            >Access Level</a>
                        </div>
                    <% } %>
                    <div class="job_questions">
                        <a href="/admin/jobOpenings">Job Openings</a>
                    </div>
                </div>
                <div class="dropdowns">
                    <% if(type==="applicants") {%>
                        <% if(jobs.length > 0 ) {%>
                            <div class="dropdown">
                                <a class="btn btn-transparent dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Jobs
                                </a>
                                <ul class="dropdown-menu">
                                    <% jobs.forEach(job => { %>
                                        <li><a class="dropdown-item" href="#<%= job.jobID %>"><%= job.jobName %></a></li>
                                    <% }) %>
                                </ul>
                            </div>
                        <% } %>
                    <%} else if(type==="access") {%>
                        <div class="dropdown">
                            <a class="btn btn-transparent dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Access Level
                            </a>
                            <ul class="dropdown-menu">
                                <% access_levels.forEach(level => { %>
                                    <li><a class="dropdown-item" href="#<%= level.access %>"><%= level.access %></a></li>
                                <% }) %>
                            </ul>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <% if(type==="access") {%>
            <div class="add_opening">
                <h6>ADD ACCESS &nbsp; &nbsp;&nbsp; </h6><a href="#" title="Add Access" data-bs-toggle="modal" data-bs-target="#addAccess" ><img src="/images/add.png" alt="Add Opening"></a>
            </div>
        <% } %>

        <% if(type==="applicants") {%>
            <div class="view_options">
                <div>
                    <input type="radio" id="All" name="status_check" value="All" checked>
                    <label for="All"> All</label>
                </div>
                <div>
                    <input type="radio" id="Applied" name="status_check" value="Applied">
                    <label for="Applied"> Applied</label>
                </div>
                <div>
                    <input type="radio" id="Shortlisted" name="status_check" value="Shortlisted">
                    <label for="Shortlisted"> Shortlisted</label>
                </div>
                <div>
                    <input type="radio" id="Rejected" name="status_check" value="Rejected">
                    <label for="Rejected"> Rejected</label>
                </div>
            </div>
        <% } %>
        
        
        <div class="positions">

            <!-- -------- Applications ---------->
            <% if(type==="applicants") {%>
                <% jobs.forEach( job => { %>
                    <div class="position_1 position <%= job.jobID %>">
                        <p class="position_heading" id="<%= job.jobID %>"> <%= `${job.jobName} - ${job.jobID}` %> </p>
                        <button class="btn btn-info download-all" data-jobID="<%= job.jobID %>">Download Applications</button>
                        <div class="cards">
                            <% applicants.forEach( applicant => { %>
                                <% if(applicant.jobID === job.jobID) {%>
                                    <div class="card" id="<%= applicant.candidateID %>">
                                        <div class="card-body">
                                            <div class="icon">
                                                <a href="#" class="download-application" title="Download candidate's application" data-applicant=<%= applicant.id %>><i class="fa fa-download"></i></a>
                                                <img src="/images/applicant.png" alt="User-icon">
                                            </div>
                                            <div class="text">
                                                <div class="text_style">
                                                    <p class="card-text"><span>Candidate No. </span>: <%= applicant.candidateID %></p>
                                                    <p class="card-text"><span>Skills </span>: <%= applicant.skills %></p>
                                                    <p class="card-text"><span>Status </span>: <select name="status_<%= applicant.id %>" disabled id="status_<%= applicant.id %>">
                                                            <option value="Applied" <% if(applicant.status === "Applied") {%> selected <% } %>>Applied</option>
                                                            <option value="Shortlisted" <% if(applicant.status === "Shortlisted") {%> selected <% } %>>Shortlisted</option>
                                                            <option value="Rejected" <% if(applicant.status === "Rejected") {%> selected <% } %>>Rejected</option>
                                                        </select>
                                                        <a href="#" title="Edit Status" onclick="editStatus(event, <%= applicant.id %>);">
                                                            <i class="fa fa-pencil"></i>
                                                        </a>
                                                    </p>
                                                    <p class="card-text"><span>Applied On </span>: <%= applicant.appliedOn %></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            <% }) %>
                        </div>
                    </div>
                <% }) %>
            <% } %>

            <!--------------- access levels ------------>

            <% if(type==="access") {%>
                <% access_levels.forEach( level => { %>
                    <div class="position_1 position">
                        <p class="position_heading" id="<%= level.access %>"> <%= level.access %> 
                            <a href="#" title="Add admin access" data-bs-toggle="modal" data-bs-target="#addAccess" data-bs-access="<%= level.access %>"><img src="/images/add.png" alt="Add_access"></a>
                        </p>
                        <div class="cards">
                            <% admins.forEach( admin => { %>
                                <% if(admin.access === level.access) {%>
                                    <div class="card" id="<%= admin.name %>">
                                        <div class="card-body">
                                            <div class="icon">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#deleteAccess" data-bs-name="<%= admin.name %>" data-bs-adminid="<%= admin.adminID %>" data-bs-email="<%= admin.email %>" data-bs-access="<%= admin.access %>" id="delete1">
                                                    <i class="fa fa-trash" title="Revoke Access"></i>
                                                </a>
                                                <img src="/images/applicant.png" alt="User-icon">
                                            </div>
                                            <div class="text">
                                                <div class="text_style">
                                                    <p class="card-text"><span>Name </span> <%= admin.name %></p>
                                                    <p class="card-text"><span>Email </span> <%= admin.email %></p>
                                                    <p class="card-text"><span>Access </span> <%= admin.access %></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                            <% }) %>
                        </div>
                    </div>
                <% }) %>
            <% } %>
            
        </div>
        <div class="no_applications">
            <img src="/images/no_applications.png" alt="no_applications">
        </div>
        <div class="no_results">
            <img src="/images/no_results.png" alt="no results found" id="no_results">
        </div>
    </div>
    
    

        <%- include ("./partials/footer.ejs") %>
    
    <!--Delete Modal -->
    <div class="modal fade" id="deleteAccess" tabindex="-1" aria-labelledby="deleteAccessLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteAccessLabel">Confirm Revoke Access</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="confirm_text"></p>
                    <form class="transferOwner" action="">
                        <% if(type==="access") {%>
                        <select name="newOwner" id="newOwner">
                            <option hidden value="">Select New Owner <span style="color: red;">*</span></option>  
                            <% admins.forEach( admin => { %>           
                                <option value="<%= admin.adminID %>" data-id="<%= admin.adminID %>" ><%= admin.name %> - <%= admin.access %></option>
                            <% }) %>
                        </select>
                        <% } %>
                    </form>
                    <span id="ownership_error" style="color: red; font-weight: 400; font-size: 0.8em;"></span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" id="confirm_delete_access">Yes Revoke</button>
                </div>
            </div>
        </div>
    </div>
    <!-- endModel -->

    <!-- add admin access modal -->
    <div class="modal fade" id="addAccess" tabindex="-1" aria-labelledby="addAccessLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAccessLabel">Access Control</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="addAccessForm" method="post">
                    <div class="modal-body">                  
                        <div class="mb-3">
                            <label for="name" class="col-form-label">Name <span style="color: red;">*</span>&nbsp;&nbsp; </label>
                            <input type="text" name="name" required class="form-control" id="name" placeholder="Eg. John Doe">
                        </div>
                        <div class="mb-3">
                            <label for="email" class="col-form-label">Email <span style="color: red;">*</span>&nbsp;&nbsp; </label>
                            <input type="email" name="email" required class="form-control" id="email" placeholder="Eg. abc@volvo.com">
                        </div>
                        <div class="mb-3">
                            <label for="pwd" class="col-form-label">Set Password <span style="color: red;">*</span>&nbsp;&nbsp; </label>
                            <input type="password" id="pwd" name="pwd"
                            pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                            title="Must contain at least one  number and one uppercase and lowercase letter, and at least 8 or more characters" required class="form-control" placeholder="Eg. xyz">
                        </div>
                        <div class="mb-3">
                            <% if(type==="access") {%>
                                <label for="access" class="col-form-label">Access:&nbsp;&nbsp; </label>
                                <!-- <input type="text" name="access" readonly class="form-control" id="access"> -->
                                <select name="access" id="access">
                                    <option hidden value="">Select Access Level*</option>
                                    <option value="HR">HR</option>
                                    <option value="Hiring Manager">Hiring Manager</option>
                                    <option value="Recruiter">Recruiter</option>
                                </select>
                            <% } %>
                        </div>
                        <span id="adminAddError" style="color: red; font-weight: 400; font-size: 0.8em;"></span>
                        <div style="color: red; font-size: 0.8em;">The fields marked with * are mandatory</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <input type="submit" class="btn btn-primary" id="allowAccess" value="Allow Access">
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- endModel -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
    <script
        src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
        crossorigin="anonymous"></script>
    <script src="/js/admin.js"></script>
    </body>
</html>